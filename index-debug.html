<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeekTools 插件市场 - Debug</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .debug { border: 2px solid red; padding: 10px; margin: 10px; background: #ffe6e6; }
    </style>
</head>
<body>
    <div class="debug">
        <h1>调试模式 - API连接测试</h1>
        <div id="debug-info"></div>
        <button onclick="testAPI()" class="bg-blue-500 text-white px-4 py-2 rounded">测试API</button>
        <button onclick="location.reload(true)" class="bg-green-500 text-white px-4 py-2 rounded">强制刷新</button>
    </div>
    
    <!-- 原始内容但带调试信息 -->
    <div id="content">加载中...</div>

    <script>
        const baseURL = 'http://localhost:3000/api/v1';
        
        async function testAPI() {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.innerHTML = '<p>正在测试API连接...</p>';
            
            try {
                // Test basic health
                const healthResponse = await fetch(`${baseURL}/health`);
                const healthData = await healthResponse.json();
                
                // Test plugins
                const pluginsResponse = await fetch(`${baseURL}/plugins`);
                const pluginsData = await pluginsResponse.json();
                
                // Test metrics
                const metricsResponse = await fetch(`${baseURL}/metrics`);
                const metricsData = await metricsResponse.json();
                
                debugDiv.innerHTML = `
                    <h3>API测试结果:</h3>
                    <p><strong>Health:</strong> ${healthResponse.ok ? '✓' : '✗'} - ${healthData.data?.status}</p>
                    <p><strong>Plugins:</strong> ${pluginsResponse.ok ? '✓' : '✗'} - ${pluginsData.data?.plugins?.length || 0} 个插件</p>
                    <p><strong>Metrics:</strong> ${metricsResponse.ok ? '✓' : '✗'} - 总插件: ${metricsData.data?.total_plugins}</p>
                    <p><strong>Base URL:</strong> ${baseURL}</p>
                    <p><strong>时间戳:</strong> ${new Date().toLocaleString()}</p>
                `;
                
                if (pluginsResponse.ok && pluginsData.data?.plugins?.length > 0) {
                    document.getElementById('content').innerHTML = `
                        <div class="p-4">
                            <h2 class="text-xl font-bold mb-4">找到 ${pluginsData.data.plugins.length} 个插件</h2>
                            <div class="grid gap-4">
                                ${pluginsData.data.plugins.map(plugin => `
                                    <div class="border p-4 rounded">
                                        <h3 class="font-bold">${plugin.name}</h3>
                                        <p>作者: ${plugin.author}</p>
                                        <p>下载量: ${plugin.downloads}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('content').innerHTML = '<p class="p-4">API连接成功但没有找到插件</p>';
                }
                
            } catch (error) {
                debugDiv.innerHTML = `
                    <h3>API连接失败:</h3>
                    <p><strong>错误:</strong> ${error.message}</p>
                    <p><strong>Base URL:</strong> ${baseURL}</p>
                    <p>请检查服务器是否运行在端口3000</p>
                `;
                document.getElementById('content').innerHTML = `<p class="p-4 text-red-500">API连接失败: ${error.message}</p>`;
            }
        }
        
        // 自动测试
        window.onload = () => {
            testAPI();
        };
    </script>
</body>
</html>